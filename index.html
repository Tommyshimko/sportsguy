<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SportsGuy</title>
    
    <!-- Google Fonts: Instrument Serif + Anton -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --green: #22C55E;
            --blue: #3B82F6;
            --bg: #FAF9F6;
            --card-bg: #FFFFFF;
            --text: #1a1a1a;
            --text-muted: #6b7280;
            --border: #e5e5e5;
            --shadow: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-lg: 0 4px 20px rgba(0,0,0,0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Anton', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
        }

        /* Screen containers */
        .screen {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            min-height: 100dvh;
        }

        .screen.active {
            display: flex;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
        }

        .icon-btn {
            width: 48px;
            height: 48px;
            background: var(--card-bg);
            border: none;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            overflow: hidden;
        }

        .icon-btn:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        .icon-btn:active {
            transform: scale(0.98);
        }

        .icon-btn img {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }

        .icon-btn svg {
            width: 22px;
            height: 22px;
            fill: var(--text);
        }

        .logo {
            font-family: 'Anton', sans-serif;
            font-size: 1.25rem;
            font-weight: 400;
            letter-spacing: 0.02em;
            text-transform: uppercase;
        }

        .text-green {
            color: var(--green);
        }

        .text-blue {
            color: var(--blue);
        }

        /* Main Screen */
        #main-screen main {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px 28px;
        }

        .quote-container {
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .quote-container:active {
            opacity: 0.7;
        }

        .quote {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: clamp(1.5rem, 6vw, 2rem);
            font-weight: 400;
            font-style: italic;
            line-height: 1.45;
            color: var(--text);
        }

        .quote-hint {
            text-align: center;
            margin-top: 40px;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 0.875rem;
            font-weight: 400;
            color: var(--text-muted);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .quote-hint.visible {
            opacity: 1;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 100;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Sport Selection Screen */
        #sport-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            z-index: 101;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
        }

        #sport-screen.active {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            position: relative;
        }

        .modal-title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Anton', sans-serif;
            font-size: 1.25rem;
            font-weight: 400;
            letter-spacing: 0.02em;
            text-transform: uppercase;
        }

        .sport-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            padding: 24px 20px;
        }

        .sport-card {
            background: var(--card-bg);
            border: none;
            border-radius: 20px;
            padding: 28px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .sport-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .sport-card:active {
            transform: scale(0.98);
        }

        .sport-card.selected {
            box-shadow: 0 0 0 2px var(--green), var(--shadow-lg);
        }

        .sport-icon {
            width: 64px;
            height: 64px;
            object-fit: contain;
        }

        .sport-name {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.125rem;
            font-weight: 400;
            color: var(--text);
        }

        /* Location Screen */
        #location-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            z-index: 101;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
        }

        #location-screen.active {
            transform: translateY(0);
        }

        .location-content {
            padding: 0 20px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--card-bg);
            border-radius: 16px;
            padding: 12px 16px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .search-bar svg {
            width: 20px;
            height: 20px;
            fill: var(--text-muted);
            flex-shrink: 0;
        }

        .search-bar input {
            flex: 1;
            border: none;
            background: none;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 1rem;
            color: var(--text);
            outline: none;
        }

        .search-bar input::placeholder {
            color: var(--text-muted);
        }

        .clear-btn {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s ease;
        }

        .clear-btn:hover {
            opacity: 1;
        }

        .clear-btn svg {
            width: 18px;
            height: 18px;
        }

        .cancel-btn {
            background: var(--bg);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--green);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .cancel-btn:hover {
            background: #f0efec;
        }

        .current-location {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }

        .current-location svg {
            width: 20px;
            height: 20px;
            fill: var(--text);
            margin-top: 2px;
        }

        .current-location-text {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .current-location-text h3 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .current-location-text p {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .current-location-text span {
            color: var(--green);
            cursor: pointer;
        }

        .location-list {
            list-style: none;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .location-item {
            padding: 18px 0;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            font-size: 1rem;
            transition: color 0.2s ease;
        }

        .location-item:hover {
            color: var(--green);
        }

        .location-item:last-child {
            border-bottom: none;
        }

        /* Loading state */
        .loading .quote {
            opacity: 0.5;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.7; }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .quote-container {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <!-- Main Screen -->
    <div id="main-screen" class="screen active">
        <header>
            <button class="icon-btn" id="sport-btn" aria-label="Choose sport">
                <img id="current-sport-icon" src="icons/basketball.png" alt="Basketball">
            </button>
            <div class="logo">
                <span class="text-green">SPORTS</span><span class="text-blue">GUY</span>
            </div>
            <button class="icon-btn" id="location-btn" aria-label="Set location">
                <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
            </button>
        </header>
        
        <main>
            <div class="quote-container" id="quote-container">
                <p class="quote" id="quote-text">"Man, that Knicks-Pacers series was brutal. You could just see how gassed they were by Game 6—Brunson gave everything, and losing OG killed their defense. Still, this team's finally got an identity. Add one more star and they're a real contender."</p>
            </div>
            <p class="quote-hint" id="quote-hint">Tap to generate a new take</p>
        </main>
    </div>

    <!-- Sport Selection Screen -->
    <div id="sport-screen" class="screen">
        <header class="modal-header">
            <button class="icon-btn" id="close-sport-btn" aria-label="Close">
                <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
            <div class="modal-title">
                <span class="text-green">CHOOSE</span> <span class="text-blue">SPORT</span>
            </div>
        </header>
        
        <div class="sport-grid">
            <button class="sport-card" data-sport="baseball" data-icon="icons/baseball.png">
                <img class="sport-icon" src="icons/baseball.png" alt="Baseball">
                <span class="sport-name">Baseball</span>
            </button>
            <button class="sport-card selected" data-sport="basketball" data-icon="icons/basketball.png">
                <img class="sport-icon" src="icons/basketball.png" alt="Basketball">
                <span class="sport-name">Basketball</span>
            </button>
            <button class="sport-card" data-sport="golf" data-icon="icons/golf.png">
                <img class="sport-icon" src="icons/golf.png" alt="Golf">
                <span class="sport-name">Golf</span>
            </button>
            <button class="sport-card" data-sport="tennis" data-icon="icons/tennis.png">
                <img class="sport-icon" src="icons/tennis.png" alt="Tennis">
                <span class="sport-name">Tennis</span>
            </button>
            <button class="sport-card" data-sport="soccer" data-icon="icons/soccer.png">
                <img class="sport-icon" src="icons/soccer.png" alt="Soccer">
                <span class="sport-name">Soccer</span>
            </button>
            <button class="sport-card" data-sport="football" data-icon="icons/football.png">
                <img class="sport-icon" src="icons/football.png" alt="Football">
                <span class="sport-name">Football</span>
            </button>
        </div>
    </div>

    <!-- Location Screen -->
    <div id="location-screen" class="screen">
        <header class="modal-header">
            <button class="icon-btn" id="close-location-btn" aria-label="Back">
                <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </button>
            <div class="modal-title">
                <span class="text-green">YOUR</span> <span class="text-blue">LOCATION</span>
            </div>
        </header>
        
        <div class="location-content">
            <div class="search-bar">
                <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                <input type="text" id="location-input" placeholder="Enter city or zip code" value="Brooklyn, NY">
                <button class="clear-btn" id="clear-location">
                    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
                <button class="cancel-btn" id="cancel-location">Cancel</button>
            </div>
            
            <div class="current-location" id="use-current-location">
                <svg viewBox="0 0 24 24"><path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" transform="rotate(-90 12 12)"/></svg>
                <div class="current-location-text">
                    <h3>Current location</h3>
                    <p>We're unable to find you. <span id="retry-location">Retry?</span></p>
                </div>
            </div>
            
            <ul class="location-list" id="location-suggestions">
                <li class="location-item">Menlo Park, CA</li>
                <li class="location-item">Menlo Park Mall, Personage Road, Edison, NJ</li>
                <li class="location-item">Menlo Park, NJ</li>
                <li class="location-item">Menlo Park Terrace, Woodbridge Township, NJ</li>
                <li class="location-item">Menlo Bridge, Orlando</li>
            </ul>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modal-overlay"></div>

    <script>
        // State
        let currentSport = 'basketball';
        let currentIcon = 'icons/basketball.png';
        let currentLocation = 'Brooklyn, NY';
        let hasInteracted = false;

        // DOM Elements
        const mainScreen = document.getElementById('main-screen');
        const sportScreen = document.getElementById('sport-screen');
        const locationScreen = document.getElementById('location-screen');
        const modalOverlay = document.getElementById('modal-overlay');
        
        const sportBtn = document.getElementById('sport-btn');
        const locationBtn = document.getElementById('location-btn');
        const closeSportBtn = document.getElementById('close-sport-btn');
        const closeLocationBtn = document.getElementById('close-location-btn');
        const cancelLocationBtn = document.getElementById('cancel-location');
        
        const currentSportIcon = document.getElementById('current-sport-icon');
        const quoteContainer = document.getElementById('quote-container');
        const quoteText = document.getElementById('quote-text');
        const quoteHint = document.getElementById('quote-hint');
        
        const locationInput = document.getElementById('location-input');
        const clearLocationBtn = document.getElementById('clear-location');
        const locationSuggestions = document.getElementById('location-suggestions');

        // Fallback quotes in case API fails
        const fallbackQuotes = {
            basketball: `"Man, the league is wild right now. Every night there's a new highlight reel play. You gotta stay locked in just to keep up with all the storylines."`,
            baseball: `"This season's been something else. The young talent coming up is unreal—these kids are playing with no fear."`,
            football: `"The parity in the league this year is crazy. Any given Sunday isn't just a saying anymore, it's the reality."`,
            soccer: `"The tactical evolution we're seeing is next level. These managers are playing 4D chess out there."`,
            golf: `"The depth on tour right now is insane. You can't take a week off or you'll drop 20 spots in the rankings."`,
            tennis: `"The changing of the guard is finally here. New generation is taking over and they're not giving it back."`,
        };

        // Functions
        function openSportScreen() {
            sportScreen.classList.add('active');
            modalOverlay.classList.add('active');
        }

        function closeSportScreen() {
            sportScreen.classList.remove('active');
            modalOverlay.classList.remove('active');
        }

        function openLocationScreen() {
            locationScreen.classList.add('active');
            modalOverlay.classList.add('active');
            locationInput.focus();
        }

        function closeLocationScreen() {
            locationScreen.classList.remove('active');
            modalOverlay.classList.remove('active');
        }

        function selectSport(sport, icon) {
            currentSport = sport;
            currentIcon = icon;
            currentSportIcon.src = icon;
            
            // Update selected state
            document.querySelectorAll('.sport-card').forEach(card => {
                card.classList.remove('selected');
                if (card.dataset.sport === sport) {
                    card.classList.add('selected');
                }
            });
            
            // Generate new quote and close
            generateQuote();
            closeSportScreen();
        }

        function selectLocation(location) {
            currentLocation = location;
            locationInput.value = location;
            closeLocationScreen();
            generateQuote();
        }

        async function generateQuote() {
            // Add loading state
            quoteContainer.classList.add('loading');
            quoteText.textContent = 'Getting the latest take...';

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        sport: currentSport,
                        location: currentLocation
                    })
                });

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                quoteText.textContent = data.quote;

            } catch (error) {
                console.error('Error generating quote:', error);
                // Use fallback quote on error
                const fallback = fallbackQuotes[currentSport] || fallbackQuotes.basketball;
                quoteText.textContent = fallback;
            }

            quoteContainer.classList.remove('loading');
            
            // Trigger animation
            quoteContainer.style.animation = 'none';
            quoteContainer.offsetHeight; // Trigger reflow
            quoteContainer.style.animation = 'fadeIn 0.5s ease-out';
        }

        // Event Listeners
        sportBtn.addEventListener('click', openSportScreen);
        locationBtn.addEventListener('click', openLocationScreen);
        closeSportBtn.addEventListener('click', closeSportScreen);
        closeLocationBtn.addEventListener('click', closeLocationScreen);
        cancelLocationBtn.addEventListener('click', closeLocationScreen);
        modalOverlay.addEventListener('click', () => {
            closeSportScreen();
            closeLocationScreen();
        });

        // Sport selection
        document.querySelectorAll('.sport-card').forEach(card => {
            card.addEventListener('click', () => {
                selectSport(card.dataset.sport, card.dataset.icon);
            });
        });

        // Location selection
        locationSuggestions.addEventListener('click', (e) => {
            if (e.target.classList.contains('location-item')) {
                selectLocation(e.target.textContent);
            }
        });

        // Clear location input
        clearLocationBtn.addEventListener('click', () => {
            locationInput.value = '';
            locationInput.focus();
        });

        // Quote tap to regenerate
        quoteContainer.addEventListener('click', () => {
            if (!hasInteracted) {
                hasInteracted = true;
                quoteHint.classList.remove('visible');
            }
            generateQuote();
        });

        // Show hint after delay
        setTimeout(() => {
            if (!hasInteracted) {
                quoteHint.classList.add('visible');
            }
        }, 3000);

        // Handle Enter key in location input
        locationInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                selectLocation(locationInput.value);
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSportScreen();
                closeLocationScreen();
            }
        });
    </script>
</body>
</html>
